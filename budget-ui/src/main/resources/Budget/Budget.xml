<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>Budget</web>
<name>Budget</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>xwiki:XWiki.ThomasMortagne</creator>
<author>xwiki:XWiki.ThomasMortagne</author>
<customClass></customClass>
<contentAuthor>xwiki:XWiki.ThomasMortagne</contentAuthor>
<creationDate>1304784052000</creationDate>
<date>1304789144000</date>
<contentUpdateDate>1304789144000</contentUpdateDate>
<version>27.4</version>
<title>Budget</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>true</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>false</hidden>
<content>{{include document="BudgetCode.BudgetService"/}}

{{velocity}}
#set($columns = ["name", "value"])
#set($columnsProperties = {
    "name" : { "link" : "view"}
})
#set($options = {
   "className":"BudgetCode.AccountPlannedTransactionClass",
   "translationPrefix" : "budget.transaction.",
   "rowCount": 15
})
#livetable("transactions" $columns $columnsProperties $options)
{{/velocity}}

= Add new planned transaction =

{{velocity}}
{{html}}
&lt;form action="$xwiki.getDocument("BudgetCode.CreatePlannedTransaction").getURL()" id="newproject" method="post"&gt;
  &lt;div&gt;
    &lt;input type="hidden" name="parent" value="$doc.fullName" /&gt;
    &lt;input type="hidden" name="classname" value="BudgetCode.AccountPlannedTransactionClass" /&gt;
    &lt;input type="hidden" name="template" value="BudgetCode.AccountPlannedTransactionClassTemplate" /&gt;
    &lt;input type="hidden" name="xaction" value="create"/&gt;
    &lt;input type="text" name="transaction" value="" size="30"/&gt;
    &lt;span class="buttonwrapper"&gt;&lt;input class="button" type="submit" value="Add this planned transaction"/&gt;&lt;/span&gt;
  &lt;/div&gt;
&lt;/form&gt;
{{/html}}
{{/velocity}}

= Stats =

{{velocity output="false"}}
#set($credits = [])
#set($debits = [])
#set($transactions = $xwiki.queryManager.xwql("select transaction.value, transaction.name from Document as doc, doc.object(BudgetCode.AccountPlannedTransactionClass) as transaction").execute())
#foreach($transaction in $transactions)
  #if ($transaction.get(0) &gt; 0)
    #set($ok = $credits.add($transaction))
  #else
    #set($positive = $transaction.get(0) * -1)
    #set($ok = $transaction.set(0, $positive))
    #set($ok = $debits.add($transaction))
  #end
#end
{{/velocity}}

{{velocity}}
#if ($context.action == 'view')
  #if (!$transactions.empty)
    #set($creditsTotal = 0)
    #if (!$credits.empty)
      {{chart type="pie" source="inline" params="range:B1-B${credits.size()};series:columns;" title="Credits"}}
        #foreach($credit in $credits)
          #set($creditsTotal = $creditsTotal + $credit.get(0))
          |$credit.get(1)|$credit.get(0)
        #end
      {{/chart}}
    #end
    #set($debitsTotal = 0)
    #if (!$debits.empty)
      {{chart type="pie" source="inline" params="range:B1-B${debits.size()};series:columns;" title="Debits"}}
        #foreach($debit in $debits)
          #set($debitsTotal = $debitsTotal + $debit.get(0))          
          |$debit.get(1)|$debit.get(0)
        #end
      {{/chart}}
    #end

    Total credits: $creditsTotal
    Total debits: $debitsTotal
  #end
#end
{{/velocity}}</content></xwikidoc>
