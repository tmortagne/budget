<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>BudgetCode</web>
<name>AccountTransactionCategoryClass</name>
<language></language>
<defaultLanguage></defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>xwiki:XWiki.ThomasMortagne</creator>
<author>xwiki:XWiki.ThomasMortagne</author>
<customClass></customClass>
<contentAuthor>xwiki:XWiki.ThomasMortagne</contentAuthor>
<creationDate>1303475833000</creationDate>
<date>1304796391000</date>
<contentUpdateDate>1304796391000</contentUpdateDate>
<version>3.69</version>
<title>Category sheet page</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>true</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>false</hidden>
<class>
<name>BudgetCode.AccountTransactionCategoryClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<content>{{velocity output="false"}}
#set($category = $doc.getObject("BudgetCode.AccountTransactionCategoryClass"))
{{/velocity}}

{{velocity}}
#if ($category)
  Name: $category.get('name')
  Descrition: $category.description
#else
  {{warning}}No //BudgetCode.AccountTransactionCategoryClass// object found.{{/warning}} 
#end
{{/velocity}}

{{velocity}}
#if ($context.action == 'view')
  #set($transactions = $xwiki.queryManager.createQuery("select year(realdate.value)||'-'||month(realdate.value), sum(value.value) from BaseObject as obj, StringProperty as category, DateProperty as realdate, DoubleProperty as value where obj.className='BudgetCode.AccountTransactionClass' and obj.id=category.id.id and category.id.name='category' and category.value = :category and obj.id=realdate.id.id and realdate.id.name='realdate' and obj.id=value.id.id and value.id.name='value' group by year(realdate.value),month(realdate.value) order by realdate.value", 'hql').bindValue('category', $category.getProperty('name').value).execute())
  #if ($transactions.size() &gt; 0)
    #set($size = $transactions.size() + 1)
    {{chart type="bar" source="inline" params="range:B2-B$size;series:columns;" title="Category value"}}
      |=Date|=Value
      #foreach($transaction in $transactions)
        #set ($positiveValue = $transaction.get(1))
        #if ($positiveValue &lt; 0)
          #set ($positiveValue = $positiveValue * -1)
        #end
        |$transaction.get(0)|$positiveValue
      #end
    {{/chart}}
  #end
#end
{{/velocity}}</content></xwikidoc>
